let express=require("express"),bodyParser=require("body-parser"),formidable=require("formidable"),jsonParser=bodyParser.json();const multer=require("multer"),upload=multer(),cors=require("cors");let urlencodedParser=bodyParser.urlencoded({extended:!1}),app=express(),connection=require("../api/dbConnection"),userManager=require("../api/getUser"),uploadFile=require("../api/uploadFile"),signupUser=require("../api/signupUser"),loginUser=require("../api/loginUser"),listItem=require("../api/listItem");app.use(cors());let formData=new formidable.IncomingForm;app.use(express.urlencoded({extended:!0}));let callForm=async(request,_function)=>new Promise(resolve=>{formData.parse(request,async(error,fields,files)=>{let resultData;console.log("request body:: ",fields),console.log(fields,files);let loginData=JSON.parse(fields.payload);resultData=await loginUser.init("login-user",loginData),console.log("result content: ",resultData),resolve(resultData)})});app.listen(3e3,()=>{console.log(" :::: Server running on port 3000 ::::: "),app.get("/get-users",(request,result,next)=>{result.json(["Tony","Lisa","Michael","Ginger","Food"])}),app.post("/list-item",(async function(request,result){let resultData;formData.parse(request,async(error,fields,files)=>{console.log("fields:: ",fields,"files:: ",files);let listData=JSON.parse(fields.payload),resultContent=await listItem.init("list-item",listData,files);resultData={resultCode:1,resultMessage:"success",resultContent:resultContent},resultData=JSON.stringify(resultData),result.send(resultData)})})),app.post("/create-user",(async function(request,result){let resultData;console.log("create user:"),formData.parse(request,async(error,fields,files)=>{console.log("request body:: ",fields),console.log(fields,files);let joinData=JSON.parse(fields.payload),resultContent=await signupUser.init("create-user",joinData);resultData={resultCode:1,resultMessage:"success",resultContent:resultContent},resultData=JSON.stringify(resultData),result.send(resultData)})})),app.post("/create-wallet",(function(request,result){})),app.post("/login-user",(async function(request,result){try{let res=await callForm(request,result);console.log("res::",res)}catch(error){}})),app.post("/login-users",(async function(request,result){console.log(request.body),result.send("JSON.stringify(loginData) + JSON.stringify(resultData)")}))});